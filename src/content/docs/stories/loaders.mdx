---
title: Loaders
description: Loadersは、Storybookのストーリーとそのデコレーターのためにデータをロードする非同期関数です。
---
import { LinkCard } from '@astrojs/starlight/components';
import { Aside } from '@astrojs/starlight/components';
import { Badge } from '@astrojs/starlight/components';


**Loaders**は、Storybookの**ストーリーとその *Decorators* のためにデータをロードする非同期関数**です。

ストーリーのレンダリングが始まる前に実行され、ロードされたデータはストーリーのレンダリングコンテキストを介してストーリーに注入されます。

### 主な用途

1.  **外部データの取得（APIフェッチなど）**：ストーリーのデータを外部（例：リモートAPI）からロードする必要がある場合に役立ちます。
2.  **アセットのロードやコンポーネントの遅延ロード**：パフォーマンス最適化のために、大きなストーリーインポートなどを処理できます。

### 推奨されるデータ管理方法

Loadersは元々、大きなストーリーインポートを処理するためのパフォーマンス最適化として設計されましたが、現在では **`args`（引数）を使用することがストーリーデータの管理において推奨されています。**

Loadersは高度な機能（エスケープハッチ）と見なされており、`args`などの他の手段では満たせない特定のニーズがある場合にのみ使用が推奨されます。

-----

## Loadersの使用方法

### ストーリーレベルのLoader <Badge text="HTML" variant="default" style={{ background: '#FF4785', border: 'unset' }} />

個々のストーリーに対して`loaders`プロパティを定義し、非同期関数を配列として渡します。<br />
ロードされたデータは、ストーリーのレンダリング関数（例：Reactの`render`関数）の第2引数であるストーリーコンテキストの `loaded` フィールドとして利用可能です。

```javascript
// TodoItem.stories.js
import { TodoItem } from './TodoItem';

/*
 * 👇 Render functions are a framework specific feature to allow you control on how the component renders.
 * See https://storybook.js.org/docs/api/csf
 * to learn how to use render functions.
 */
// Storybookのdefault exportに相当するオブジェクト
export default {
  component: TodoItem,
  // render関数はJSXを返していますが、純粋なJSの文脈では
  // Storybookが期待する構造を表現するためにアロー関数として残します。
  render: (args, { loaded: { todo } }) => {
    // 実際には、この中でTodoItemコンポーネントをレンダリングする
    // フレームワーク固有のコード（例: React.createElement, Vue.h など）が入りますが、
    // ここでは構造を維持するために関数定義として残します。
    // プレーンなJSでは、このTodoItemの使用は特殊な意味を持ちません。
    return TodoItem({ ...args, ...todo }); // 概念的にコンポーネントを呼び出す表現
  },
};

// Primary Storyに相当するオブジェクト
export const Primary = {
  // Storybookのloaders配列に相当
  loaders: [
    async () => {
      const response = await fetch('https://jsonplaceholder.typicode.com/todos/1');
      const todo = await response.json();
      return { todo };
    },
  ],
};
```

### Global Loaders

`.storybook/preview.js`（または`.ts`）ファイル内で`loaders`をエクスポートすることで、**すべてのストーリー**に対してLoaderを設定できます。

```javascript
// .storybook/preview.js
export default {
  loaders: [
    async () => ({
      currentUser: await (await fetch('https://jsonplaceholder.typicode.com/users/1')).json(),
    }),
  ],
};
```

## Loaderの継承と実行順序

Loaderは、パラメーターと同様に**グローバル**、**コンポーネントレベル**、**単一ストーリー**の3つのレベルで定義できます。

適用されるすべてのレベルのLoaderは、ストーリーがレンダリングされる前に**並行して実行**されます。

ロードされたすべての結果は、ストーリーコンテキストの **`loaded`** フィールドに結合されます。もし同じキーでデータが重複した場合、**より具体的なレベルのLoader**が優先されます（後に実行されたLoaderが上書きします）。

**優先順位（低い → 高い）：**
1.  グローバルLoader（定義された順）
2.  コンポーネントLoader（定義された順）
3.  ストーリーLoader（定義された順）

<div
  style="margin-block-start: 48px;">
  <LinkCard
    title="Storybook Loaders Docs"
    href="https://storybook.js.org/docs/9/writing-stories/loaders"
    target={'_blank'} />
</div>